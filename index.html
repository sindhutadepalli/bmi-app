<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Smart BMI Tracker</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap");
      body {
        margin: 0;
        padding: 0;
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe, #f5f3ff);
        display: flex;
        justify-content: center;
        min-height: 100vh;
        color: #1f2937;
      }
      .container {
        width: 100%;
        max-width: 700px;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.08);
        padding: 32px;
        margin: 30px 15px;
        animation: fadeIn 0.5s ease;
      }
      h1,
      h2,
      h3 {
        font-weight: 600;
        margin: 0 0 16px;
      }
      h1 {
        font-size: 1.8rem;
        color: #2563eb;
      }
      h2 {
        font-size: 1.3rem;
        margin-top: 24px;
      }
      input {
        width: 100%;
        padding: 12px;
        margin: 8px 0;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        font-size: 0.95rem;
      }
      button {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      button.primary {
        background: #2563eb;
        color: #fff;
      }
      button.primary:hover {
        background: #1d4ed8;
      }
      button.danger {
        background: #ef4444;
        color: #fff;
        margin-top: 12px;
      }
      button.danger:hover {
        background: #dc2626;
      }
      .muted {
        color: #6b7280;
        font-size: 0.9rem;
      }
      .card {
        background: #f9fafb;
        border-radius: 16px;
        padding: 16px 20px;
        margin: 16px 0;
      }
      .bmi-status {
        text-align: center;
        padding: 14px;
        border-radius: 12px;
        margin-top: 14px;
        font-weight: 600;
        font-size: 1rem;
      }
      .underweight {
        background: #e0f2fe;
        color: #0369a1;
      }
      .normal {
        background: #dcfce7;
        color: #166534;
      }
      .overweight {
        background: #fef9c3;
        color: #854d0e;
      }
      .obese {
        background: #fee2e2;
        color: #991b1b;
      }
      ul {
        margin: 10px 0;
        padding-left: 20px;
      }
      li {
        margin: 6px 0;
        font-size: 0.92rem;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="container" id="auth-card">
      <h1>Smart BMI Tracker</h1>
      <p class="muted">Sign up or log in to start tracking your BMI history.</p>

      <h2>Create Account</h2>
      <input id="su-email" placeholder="Email" />
      <input id="su-password" type="password" placeholder="Password" />
      <button class="primary" id="signup-btn">Sign Up</button>

      <h2>Login</h2>
      <input id="li-email" placeholder="Email" />
      <input id="li-password" type="password" placeholder="Password" />
      <button class="primary" id="login-btn">Login</button>
    </div>

    <div class="container" id="app-card" style="display: none">
      <h1>Your BMI Dashboard</h1>
      <p class="muted">Logged in as <span id="user-email"></span></p>
      <button class="danger" id="logout-btn">Logout</button>

      <div class="card">
        <h2>Calculate BMI</h2>
        <input id="weight" placeholder="Weight (kg)" />
        <input id="height" placeholder="Height (cm)" />
        <button class="primary" id="calc-btn">Calculate & Save</button>
        <p id="bmi-result" class="muted"></p>
        <div id="bmi-status"></div>
        <p id="bmi-suggestion" class="muted"></p>
      </div>

      <div class="card">
        <h2>Your History</h2>
        <ul id="history"></ul>
      </div>

      <div class="card">
        <h2>What is BMI?</h2>
        <p class="muted">
          Body Mass Index (BMI) is a quick calculation using height and weight:
          <b>BMI = weight (kg) / [height (m)]¬≤</b>. It helps classify
          underweight, healthy weight, overweight, and obesity in adults.
          <br /><br />
          ‚ö†Ô∏è Note: BMI is a general guideline. It does not directly measure body
          fat and may not apply equally to athletes, children, or the elderly.
        </p>
      </div>

      <div class="card">
        <h2>Health Tips</h2>
        <ul>
          <li>
            ü•¶ Eat a balanced diet with plenty of vegetables, fruits, and
            proteins.
          </li>
          <li>
            üèÉ Stay active ‚Äî aim for at least 30 minutes of exercise daily.
          </li>
          <li>üíß Drink enough water throughout the day.</li>
          <li>üò¥ Maintain proper sleep (7‚Äì9 hours per night).</li>
          <li>üßò Manage stress with meditation, yoga, or hobbies.</li>
        </ul>
      </div>

      <div class="card">
        <h2>How to Maintain a Healthy BMI</h2>
        <p class="muted">
          ‚Ä¢ <b>Underweight:</b> Focus on nutrient-rich meals and strength
          training. ‚Ä¢ <b>Normal:</b> Continue balanced diet and regular
          exercise. ‚Ä¢ <b>Overweight:</b> Reduce sugary foods, increase physical
          activity. ‚Ä¢ <b>Obese:</b> Seek medical guidance; adopt gradual,
          sustainable changes.
        </p>
      </div>
    </div>

    <script type="module">
      const SUPABASE_URL = "https://zktogaryendkoxafpjjc.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprdG9nYXJ5ZW5ka294YWZwampjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3Nzc4MTEsImV4cCI6MjA3NDM1MzgxMX0.evWDTE2vsgvc7YCYyZq2jA3TD8FATNPtGjs8IrZProU";

      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
      const supabase = createClient(
        "https://zktogaryendkoxafpjjc.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprdG9nYXJ5ZW5ka294YWZwampjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3Nzc4MTEsImV4cCI6MjA3NDM1MzgxMX0.evWDTE2vsgvc7YCYyZq2jA3TD8FATNPtGjs8IrZProU"
      );

      const authCard = document.getElementById("auth-card");
      const appCard = document.getElementById("app-card");
      const signupBtn = document.getElementById("signup-btn");
      const loginBtn = document.getElementById("login-btn");
      const logoutBtn = document.getElementById("logout-btn");
      const calcBtn = document.getElementById("calc-btn");
      const historyEl = document.getElementById("history");
      const bmiResult = document.getElementById("bmi-result");
      const bmiStatusDiv = document.getElementById("bmi-status");
      const bmiSuggestion = document.getElementById("bmi-suggestion");
      const userEmailEl = document.getElementById("user-email");

      function showAuth() {
        authCard.style.display = "block";
        appCard.style.display = "none";
      }
      function showApp() {
        authCard.style.display = "none";
        appCard.style.display = "block";
      }

      signupBtn.addEventListener("click", async () => {
        const email = document.getElementById("su-email").value;
        const password = document.getElementById("su-password").value;
        const { error } = await supabase.auth.signUp({ email, password });
        if (error) return alert("Sign up error: " + error.message);
        alert("Account created. Check your email.");
      });

      loginBtn.addEventListener("click", async () => {
        const email = document.getElementById("li-email").value;
        const password = document.getElementById("li-password").value;
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error) return alert("Login error: " + error.message);
      });

      logoutBtn.addEventListener("click", async () => {
        await supabase.auth.signOut();
      });

      calcBtn.addEventListener("click", async () => {
        const w = parseFloat(document.getElementById("weight").value);
        const h = parseFloat(document.getElementById("height").value);
        if (!w || !h) {
          alert("Enter weight & height");
          return;
        }
        const bmi = +(w / ((h / 100) * (h / 100))).toFixed(1);
        bmiResult.textContent = `Your BMI: ${bmi}`;
        let status = "",
          suggestion = "",
          cls = "";
        if (bmi < 18.5) {
          status = "Underweight";
          suggestion = "Add calorie-dense, healthy foods.";
          cls = "underweight";
        } else if (bmi < 24.9) {
          status = "Normal";
          suggestion = "Great! Keep your balanced routine.";
          cls = "normal";
        } else if (bmi < 29.9) {
          status = "Overweight";
          suggestion = "Incorporate more activity and mindful eating.";
          cls = "overweight";
        } else {
          status = "Obese";
          suggestion = "Seek professional guidance for safe weight loss.";
          cls = "obese";
        }
        bmiStatusDiv.className = `bmi-status ${cls}`;
        bmiStatusDiv.textContent = `Category: ${status}`;
        bmiSuggestion.textContent = suggestion;

        const { data: userData } = await supabase.auth.getUser();
        if (!userData.user) return alert("Please login again.");
        await supabase
          .from("bmi_records")
          .insert([{ user_id: userData.user.id, weight: w, height: h, bmi }]);
        loadHistory();
      });

      async function loadHistory() {
        historyEl.innerHTML = '<li class="muted">Loading...</li>';
        const { data, error } = await supabase
          .from("bmi_records")
          .select("weight,height,bmi,created_at")
          .order("created_at", { ascending: false });
        if (error)
          return (historyEl.innerHTML =
            '<li class="muted">Error loading history</li>');
        historyEl.innerHTML = "";
        if (!data.length)
          return (historyEl.innerHTML =
            '<li class="muted">No records yet</li>');
        data.forEach((r) => {
          const d = new Date(r.created_at).toLocaleString();
          const li = document.createElement("li");
          li.textContent = `${d} ‚Äî ${r.weight}kg, ${r.height}cm ‚Üí BMI ${r.bmi}`;
          historyEl.appendChild(li);
        });
      }

      async function init() {
        const sess = await supabase.auth.getSession();
        if (sess.data.session?.user) {
          userEmailEl.textContent = sess.data.session.user.email;
          showApp();
          loadHistory();
        } else {
          showAuth();
        }
        supabase.auth.onAuthStateChange((_e, session) => {
          if (session?.user) {
            userEmailEl.textContent = session.user.email;
            showApp();
            loadHistory();
          } else showAuth();
        });
      }
      init();
    </script>
  </body>
</html>


